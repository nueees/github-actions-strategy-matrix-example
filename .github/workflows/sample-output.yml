name: Sample Run Max 2 Jobs In Parallel
on: 
  push:
      branches:
        - '*'
jobs:
  detect-changed-lambdas:
    name: Detect changed Lambda functions
    runs-on: ubuntu-latest

    outputs:
      lambdas_files: ${{ steps.detect_changes.outputs.lambdas_files }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4

      - name: Detect changed Lambda files
        uses: dorny/paths-filter@v2
        id: detect_changes
        with:
          base: 'TECHM-01_test'
          list-files: 'json'
          filters: |
            lambdas: 'lambda/**'

            
  apply-changed-lambdas:
    name: Build Docker images for changed Lambdas
    needs: detect-changed-lambdas
    runs-on: ubuntu-latest

    steps:
    - run: echo Run ${{ fromJson(needs.detect-changed-lambdas.outputs.lambdas_files) }}
    - run: date
    - run: sleep 5 # Sleep so that we can see a difference in timestamp on the last run
    - run: date